---
name: 股票投资分析助手
description: 美股投资管理Agent - 自动分析持仓、生成技术指标报告并同步到飞书
---

# 股票投资分析助手

## 📋 简介

这个skill提供了完整的美股投资管理工具链，包括：
- 📊 持仓实时分析
- 📈 技术指标计算（RSI, MACD, KDJ, 布林带）
- 💡 智能交易建议生成
- 🔄 数据自动同步到飞书多维表格

## 🚀 快速开始

### 前置条件

1. **持仓文件**: 确保项目根目录有 `my_portfolio.xlsx` 文件，格式如下：
   | 代码 | 名称 | 股数 | 成本价 | 购买日期 | 备注 |
   |------|------|------|--------|----------|------|
   | BABA | 阿里巴巴 | 70 | 109.00 | 2024-01-01 | |
   | PDD | 拼多多 | 100 | 107.08 | 2024-01-15 | |

2. **飞书配置** (可选): 如需同步到飞书，需配置 `feishu_config.json`：
   ```json
   {
     "app_id": "你的飞书应用ID",
     "app_secret": "你的飞书应用密钥",
     "app_token": "你的飞书多维表格token"
   }
   ```

3. **Python依赖**: 
   ```bash
   pip install pandas yfinance requests openpyxl
   ```

## 📖 使用方法

### 1. 分析持仓

**命令**:
```bash
python3 分析持仓.py
```

**功能**:
- 读取 `my_portfolio.xlsx` 中的持仓数据
- 自动获取最新股价（支持Yahoo Finance、FMP、Polygon等多个数据源）
- 计算盈亏情况
- 分析技术指标（RSI、MACD、KDJ、布林带）
- 生成交易建议（BUY/HOLD/SELL）

**输出示例**:
```
======================================================================
📊 持仓分析报告汇总
======================================================================
代码       现价         盈亏%        RSI      建议        
----------------------------------------------------------------------
BABA     $169.56     +55.56%    54.7     HOLD      
PDD      $101.05     -5.63%     28.0     HOLD      

======================================================================
💰 账户总额概览
  总投入:     $18,338.00
  当前市值:   $21,974.20
  总盈亏:     $3,636.20 (+19.83%)
======================================================================
```

### 2. 同步到飞书

**命令**:
```bash
python3 同步分析到飞书.py
```

**功能**:
- 执行持仓分析
- 将基本信息同步到飞书「持仓管理」表
- 将技术分析结果同步到飞书「数据表」
- 自动更新时间戳

**同步内容**:

**持仓管理表**:
- 股票代码、名称
- 持有数量、成本价、当前价
- 盈亏金额、盈亏比例
- 市场分类、购买日期

**技术分析表**:
- 当前价格、RSI指标
- MACD信号、KDJ信号
- 综合评分、操作建议
- 分析原因、更新时间

### 3. 分析单个股票

**命令**:
```bash
python3 分析特斯拉.py    # 分析TSLA
python3 分析PDD.py       # 分析PDD
```

**功能**:
- 深度分析单个股票
- 详细的技术指标解读
- 价格走势分析
- 新手友好的投资建议

## 🛠️ 核心模块说明

### 1. `scripts/data_fetcher.py`
数据获取模块，支持多个数据源：
- **Yahoo Finance** (主要数据源)
- **FMP (Financial Modeling Prep)** (备用数据源)
- **Polygon.io** (备用数据源)
- **本地缓存** (提高响应速度，减少API调用)

### 2. `scripts/indicators.py`
技术指标计算模块：
- `calculate_rsi()` - 相对强弱指标
- `calculate_macd()` - MACD指标
- `calculate_kdj()` - KDJ随机指标
- `calculate_bollinger_bands()` - 布林带

### 3. `scripts/beginner_analyzer.py`
智能分析模块：
- 综合多个技术指标
- 生成交易建议（BUY/HOLD/SELL）
- 提供评分和详细理由
- 新手友好的解释

### 4. `scripts/portfolio.py`
持仓管理模块：
- 读写Excel持仓文件
- 数据验证和格式化

### 5. `scripts/feishu_sync.py`
飞书同步模块：
- 连接飞书API
- 同步数据到多维表格
- 自动更新或创建记录

## 📊 技术指标说明

### RSI (相对强弱指标)
- **范围**: 0-100
- **超买**: RSI > 70 (可能回调)
- **超卖**: RSI < 30 (可能反弹)
- **中性**: 30-70

### MACD (异同移动平均线)
- **金叉**: MACD上穿信号线，看涨
- **死叉**: MACD下穿信号线，看跌
- **柱状图**: 正值增强看涨，负值增强看跌

### KDJ (随机指标)
- **超买区**: K > 80
- **超卖区**: K < 20
- **金叉**: K上穿D，买入信号
- **死叉**: K下穿D，卖出信号

### 布林带
- **上轨**: 阻力位
- **中轨**: 移动平均线
- **下轨**: 支撑位
- **突破上轨**: 超买
- **跌破下轨**: 超卖

## 🎯 使用场景

### 场景1: 每日快速检查
```bash
# 快速查看所有持仓状态
python3 分析持仓.py
```

### 场景2: 定期同步到飞书
```bash
# 每周同步一次到飞书，便于长期跟踪
python3 同步分析到飞书.py
```

### 场景3: 重点关注某只股票
```bash
# 深度分析单只股票
python3 分析特斯拉.py
```

### 场景4: 结合Cron定时任务
```bash
# 添加到crontab，每天收盘后自动分析
0 17 * * 1-5 cd /path/to/stock-master && python3 同步分析到飞书.py
```

## 🔧 自定义配置

### 修改数据源优先级
编辑 `scripts/data_fetcher.py`，调整 `get_stock_data()` 方法中的数据源顺序。

### 调整技术指标参数
编辑 `scripts/indicators.py`：
- RSI周期 (默认14天)
- MACD参数 (默认12, 26, 9)
- KDJ参数 (默认9, 3, 3)
- 布林带参数 (默认20, 2)

### 自定义交易策略
编辑 `scripts/beginner_analyzer.py`，修改 `generate_trading_recommendation()` 函数中的规则。

## 📝 文件结构

```
stock-master/
├── 分析持仓.py                 # 持仓分析主脚本
├── 同步分析到飞书.py           # 飞书同步脚本
├── 分析特斯拉.py               # TSLA分析示例
├── 分析PDD.py                  # PDD分析示例
├── my_portfolio.xlsx          # 持仓数据文件
├── config.json                # API配置
├── feishu_config.json         # 飞书配置
├── scripts/
│   ├── data_fetcher.py        # 数据获取模块
│   ├── indicators.py          # 技术指标模块
│   ├── beginner_analyzer.py   # 智能分析模块
│   ├── portfolio.py           # 持仓管理模块
│   ├── feishu_sync.py         # 飞书同步模块
│   └── stock_cache.db         # 数据缓存数据库
└── .agent/
    └── skills/
        └── stock-analysis/
            └── SKILL.md       # 本文件
```

## ⚠️ 注意事项

1. **API限流**: 免费API有调用限制，使用缓存可以减少请求次数
2. **数据延迟**: 免费数据可能有15-20分钟延迟
3. **投资风险**: 本工具仅供参考，不构成投资建议
4. **配置安全**: 不要将 `config.json` 和 `feishu_config.json` 提交到公开仓库

## 🔄 更新记录

### v1.0 (2026-01-31)
- ✅ 初始版本
- ✅ 支持持仓分析
- ✅ 支持飞书同步
- ✅ 多数据源支持
- ✅ 本地缓存功能
- ✅ 技术指标计算
- ✅ 智能交易建议

## 💡 最佳实践

1. **定期更新持仓文件**: 每次交易后及时更新 `my_portfolio.xlsx`
2. **合理使用缓存**: 日内多次查询使用缓存，跨日分析清除缓存
3. **结合多个指标**: 不要只看单一指标，综合判断
4. **长期跟踪**: 定期同步到飞书，建立历史数据
5. **风险控制**: 设置止损点，不要过度依赖技术分析

## 📚 参考资源

- [Yahoo Finance](https://finance.yahoo.com/)
- [飞书开放平台](https://open.feishu.cn/)
- [技术指标详解](https://www.investopedia.com/)

## 🆘 常见问题

**Q: 数据获取失败怎么办？**
A: 检查网络连接，或等待一段时间后重试。脚本会自动尝试备用数据源。

**Q: 如何添加新的股票？**
A: 在 `my_portfolio.xlsx` 中添加新行即可。

**Q: 飞书同步失败？**
A: 检查 `feishu_config.json` 配置是否正确，确认表格ID是否匹配。

**Q: 如何清除缓存？**
A: 删除 `scripts/stock_cache.db` 文件即可。

## 📞 支持

如有问题，请检查：
1. Python依赖是否安装完整
2. 配置文件格式是否正确
3. 持仓文件是否存在且格式正确
4. 网络连接是否正常
